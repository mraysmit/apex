# Compound Key Lookup Example Configuration
# Demonstrates compound lookup-key using string concatenation
# Use Case: Customer-region specific pricing and tier information lookup

metadata:
  id: "Compound Key Lookup Demo"
  name: "Compound Key Lookup Demo"
  version: "1.0.0"
  description: "Demonstrates compound key lookup using customer ID and region concatenation"
  type: "enrichment"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  tags: ["apex-demo", "lookup", "compound-key"]

# Define the enrichment rules
enrichments:
  - id: "customer-region-pricing-enrichment"
    name: "Customer-Region Pricing Lookup"
    description: "Enrich orders with customer-region specific pricing and tier information"
    type: "lookup-enrichment"
    enabled: true
    condition: "#customerId != null && #region != null"
    
    lookup-config:
      # Compound key using string concatenation - combines customer ID and region
      lookup-key: "#customerId + '-' + #region"
      
      lookup-dataset:
        type: "inline"
        key-field: "customerRegionKey"
        data:
          # Premium customers in North America
          - customerRegionKey: "CUST001-NA"
            customerTier: "PLATINUM"
            regionalDiscount: 0.15
            specialPricing: "VOLUME_DISCOUNT"
            customerName: "TechCorp Solutions"
            regionName: "North America"
            currency: "USD"
            taxRate: 0.08
            
          - customerRegionKey: "CUST002-NA"
            customerTier: "GOLD"
            regionalDiscount: 0.12
            specialPricing: "STANDARD_DISCOUNT"
            customerName: "InnovateTech Inc"
            regionName: "North America"
            currency: "USD"
            taxRate: 0.08
            
          # European customers
          - customerRegionKey: "CUST001-EU"
            customerTier: "GOLD"
            regionalDiscount: 0.10
            specialPricing: "EU_PRICING"
            customerName: "TechCorp Solutions Europe"
            regionName: "Europe"
            currency: "EUR"
            taxRate: 0.20
            
          - customerRegionKey: "CUST003-EU"
            customerTier: "SILVER"
            regionalDiscount: 0.08
            specialPricing: "STANDARD_DISCOUNT"
            customerName: "EuroTech GmbH"
            regionName: "Europe"
            currency: "EUR"
            taxRate: 0.19
            
          # Asia-Pacific customers
          - customerRegionKey: "CUST004-APAC"
            customerTier: "PLATINUM"
            regionalDiscount: 0.18
            specialPricing: "APAC_PREMIUM"
            customerName: "Asia Pacific Technologies"
            regionName: "Asia Pacific"
            currency: "USD"
            taxRate: 0.10
            
          - customerRegionKey: "CUST005-APAC"
            customerTier: "GOLD"
            regionalDiscount: 0.14
            specialPricing: "VOLUME_DISCOUNT"
            customerName: "Singapore Tech Solutions"
            regionName: "Asia Pacific"
            currency: "SGD"
            taxRate: 0.07
            
          # Latin America customers
          - customerRegionKey: "CUST006-LATAM"
            customerTier: "SILVER"
            regionalDiscount: 0.12
            specialPricing: "EMERGING_MARKET"
            customerName: "LatAm Technology Partners"
            regionName: "Latin America"
            currency: "USD"
            taxRate: 0.15
            
          # Middle East customers
          - customerRegionKey: "CUST007-ME"
            customerTier: "GOLD"
            regionalDiscount: 0.13
            specialPricing: "REGIONAL_PARTNER"
            customerName: "Middle East Tech Hub"
            regionName: "Middle East"
            currency: "USD"
            taxRate: 0.05
            
          # Cross-region customer (same customer, different region)
          - customerRegionKey: "CUST002-EU"
            customerTier: "GOLD"
            regionalDiscount: 0.11
            specialPricing: "EU_PRICING"
            customerName: "InnovateTech Europe"
            regionName: "Europe"
            currency: "EUR"
            taxRate: 0.21
            
          - customerRegionKey: "CUST004-NA"
            customerTier: "PLATINUM"
            regionalDiscount: 0.16
            specialPricing: "CROSS_REGION_PREMIUM"
            customerName: "Asia Pacific Technologies USA"
            regionName: "North America"
            currency: "USD"
            taxRate: 0.09
    
    # Map the lookup results to target fields
    field-mappings:
      - source-field: "customerTier"
        target-field: "customerTier"
        required: true
        
      - source-field: "regionalDiscount"
        target-field: "regionalDiscount"
        required: true
        
      - source-field: "specialPricing"
        target-field: "specialPricing"
        required: false
        
      - source-field: "customerName"
        target-field: "customerName"
        required: true
        
      - source-field: "regionName"
        target-field: "regionName"
        required: true
        
      - source-field: "currency"
        target-field: "currency"
        required: true
        
      - source-field: "taxRate"
        target-field: "taxRate"
        required: true

# Optional validation rules
validations:
  - id: "customer-id-format"
    name: "Customer ID Format Validation"
    description: "Ensure customer ID follows expected format"
    type: "field-validation"
    enabled: true
    condition: "#customerId != null"
    
    validation-config:
      field: "customerId"
      rules:
        - type: "regex"
          pattern: "^CUST\\d{3}$"
          message: "Customer ID must be in format CUST### (e.g., CUST001)"
          
  - id: "region-code-validation"
    name: "Region Code Validation"
    description: "Ensure region code is valid"
    type: "field-validation"
    enabled: true
    condition: "#region != null"
    
    validation-config:
      field: "region"
      rules:
        - type: "enum"
          allowedValues: ["NA", "EU", "APAC", "LATAM", "ME", "AFRICA"]
          message: "Region must be one of: NA, EU, APAC, LATAM, ME, AFRICA"
          
  - id: "quantity-positive"
    name: "Positive Quantity Validation"
    description: "Ensure order quantity is positive"
    type: "field-validation"
    enabled: true
    condition: "#quantity != null"
    
    validation-config:
      field: "quantity"
      rules:
        - type: "range"
          min: 1
          message: "Order quantity must be at least 1"

# Processing configuration
processing:
  continue-on-error: true
  max-errors: 5
  error-handling: "log-and-continue"

