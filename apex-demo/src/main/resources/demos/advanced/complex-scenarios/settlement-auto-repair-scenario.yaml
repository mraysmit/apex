# ============================================================================
# SETTLEMENT AUTO-REPAIR PROCESSING SCENARIO
# ============================================================================
#
# This scenario configuration defines the processing pipeline for Settlement
# Instructions that require auto-repair. It provides lightweight routing to
# the comprehensive custody auto-repair bootstrap configuration.
#
# PURPOSE:
# - Associates Settlement Instructions with their auto-repair processing pipeline
# - Provides scenario-specific metadata and routing information
# - Enables data type-based automatic routing to appropriate rule configurations
# - Supports business domain organization and ownership tracking
#
# ARCHITECTURE:
# - Scenario files provide lightweight routing and metadata
# - Bootstrap files contain the complete rule definitions and datasets
# - This separation enables flexible scenario management and reuse
#
# ============================================================================

metadata:
  name: "Settlement Auto-Repair Scenario"
  version: "1.0.0"
  description: "Associates settlement instructions with custody auto-repair processing for intelligent failure resolution"
  type: "scenario"
  business-domain: "Post-TradeB Settlement"
  regulatory-scope: "Asian Markets (Japan, Hong Kong, Singapore, Korea)"
  owner: "settlements.asia@company.com"
  created-by: "Mark Andrew Ray-Smith Cityline Ltd"
  created: "2025-08-02"
  last-modified: "2025-08-02"
  compliance-reviewed: true
  compliance-reviewer: "compliance.settlements@company.com"
  compliance-date: "2025-08-01"
  risk-approved: true
  risk-reviewer: "risk.settlements@company.com"
  risk-date: "2025-08-01"

# ============================================================================
# SCENARIO CONFIGURATION
# ============================================================================

scenario:
  # Scenario identification
  scenario-id: "settlement-auto-repair"
  name: "Settlement Auto-Repair Processing"
  description: "Intelligent auto-repair for failed settlement instructions in Asian markets"
  
  # Data types handled by this scenario
  data-types:
    - "dev.mars.apex.demo.bootstrap.model.BootstrapSettlementInstruction"
    - "SettlementInstruction"
    - "CustodyInstruction"
    - "DeliveryInstruction"
  
  # Business context
  business-domain: "Post-TradeB Settlement"
  business-process: "Settlement Instruction Auto-Repair"
  regulatory-requirements:
    - "Asian Markets Settlement Rules"
    - "Custody and Safekeeping Regulations"
    - "Cross-Border Settlement Compliance"
    - "Anti-Money Laundering (AML)"
  
  # Rule configuration files to load for this scenario
  rule-configurations:
    - "demos/bootstrap/custody-auto-repair/bootstrap-config.yaml"
  
  # Processing settings
  processing:
    enabled: true
    priority: "critical"
    timeout-ms: 10000
    retry-attempts: 5
    
  # Routing conditions (optional - used for complex routing logic)
  routing-conditions:
    - condition: "#data.class.simpleName.contains('SettlementInstruction')"
      description: "Route settlement instructions by class name"
    - condition: "#data.status == 'FAILED' || #data.status == 'REJECTED'"
      description: "Route failed or rejected instructions"
    - condition: "#data.market in {'JP', 'HK', 'SG', 'KR'}"
      description: "Route Asian market settlements"
    - condition: "#businessContext == 'settlement-repair'"
      description: "Route by business context"

# ============================================================================
# SCENARIO DEPENDENCIES
# ============================================================================

dependencies:
  # Required configuration files
  required-configs:
    - path: "demos/bootstrap/custody-auto-repair/bootstrap-config.yaml"
      description: "Complete custody auto-repair processing configuration"
      type: "bootstrap"
    
  # Optional configuration files
  optional-configs:
    - path: "demos/fundamentals/rules/settlement-validation-rules.yaml"
      description: "Reusable settlement validation rules"
      type: "rules"
      fallback-behavior: "continue"

# ============================================================================
# BUSINESS METADATA
# ============================================================================

business:
  # Ownership and responsibility
  owner: "settlements.asia@company.com"
  business-analyst: "ba.settlements@company.com"
  technical-lead: "tech.settlements@company.com"
  
  # Business context
  business-domain: "Post-TradeB Settlement"
  business-process: "Settlement Auto-Repair"
  business-criticality: "critical"
  
  # Regulatory context
  regulatory-scope: "Asian Markets (Japan, Hong Kong, Singapore, Korea)"
  compliance-requirements:
    - requirement: "Asian Markets Settlement Rules"
      deadline: "T+2"
      criticality: "mandatory"
    - requirement: "Custody and Safekeeping Regulations"
      deadline: "T+1"
      criticality: "mandatory"
    - requirement: "Cross-Border Settlement Compliance"
      deadline: "T+3"
      criticality: "mandatory"
  
  # SLA requirements
  sla:
    processing-time-target: "< 500ms"
    availability-target: "99.99%"
    error-rate-target: "< 0.01%"
    repair-success-rate: "> 95%"

# ============================================================================
# TECHNICAL METADATA
# ============================================================================

technical:
  # Performance characteristics
  performance:
    expected-volume: "1,000 failed instructions/day"
    peak-volume: "5,000 failed instructions/day"
    processing-time-p95: "250ms"
    processing-time-p99: "500ms"
    repair-success-rate: "97%"
  
  # Integration points
  integrations:
    - system: "Settlement System"
      interface: "REST API"
      data-format: "JSON"
    - system: "Custody System"
      interface: "Message Queue"
      data-format: "XML"
    - system: "Standing Instructions Database"
      interface: "Database Connection"
      data-format: "SQL"
    - system: "Market Data Provider"
      interface: "WebSocket"
      data-format: "JSON"
  
  # Monitoring and alerting
  monitoring:
    metrics:
      - "processing.time"
      - "error.rate"
      - "throughput"
      - "repair.success.rate"
      - "manual.intervention.rate"
    alerts:
      - condition: "processing.time > 1000ms"
        severity: "warning"
      - condition: "error.rate > 0.1%"
        severity: "critical"
      - condition: "repair.success.rate < 90%"
        severity: "warning"
      - condition: "manual.intervention.rate > 10%"
        severity: "warning"

# ============================================================================
# SCENARIO EXECUTION SETTINGS
# ============================================================================

execution:
  # Execution mode
  mode: "synchronous"
  
  # Error handling
  error-handling:
    strategy: "continue-with-fallback"
    retry-policy:
      max-attempts: 5
      backoff-strategy: "exponential"
      initial-delay-ms: 200
    fallback-strategy: "manual-intervention"
    
  # Audit and logging
  audit:
    enabled: true
    log-level: "DEBUG"
    include-sensitive-data: true
    retention-days: 365
  
  # Settlement-specific settings
  settlement-settings:
    auto-repair-strategies:
      - "standing-instruction-lookup"
      - "counterparty-default-repair"
      - "market-convention-repair"
      - "historical-pattern-repair"
    high-value-threshold: 10000000
    manual-intervention-threshold: 50000000
    asian-markets-support:
      enabled: true
      markets: ["JP", "HK", "SG", "KR"]
      business-hours-only: true
