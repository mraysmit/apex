# Comprehensive Financial Settlement Demo Configuration
# Real APEX YAML configuration for ComprehensiveFinancialSettlementDemo.java
# NO HARDCODED SIMULATION - Uses authentic APEX services

metadata:
  id: "comprehensive-financial-settlement-demo-configuration"
  name: "Comprehensive Financial Settlement Demo Configuration"
  version: "2.0.0"
  description: "Real APEX comprehensive financial settlement demonstration with multi-asset processing, cross-border settlement, and high-value transaction handling"
  type: "rule-config"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  tags: ["apex-demo", "enrichment", "financial", "settlement"]

# Data sources for comprehensive financial settlement
data-sources:
  - name: "settlement-config"
    type: "inline"
    description: "Settlement configuration data source"

# Multi-Asset Settlement Processing Enrichments
enrichments:
  # 1. Settlement Date Calculation based on Market Conventions
  - id: "settlement-date-calculation"
    name: "settlement-date-calculation"
    type: "calculation-enrichment"
    description: "Calculate settlement date based on market conventions"
    condition: "#market != null && #assetClass != null"
    calculation-config:
      expression: "#market == 'UK' ? (#assetClass == 'EQUITY' ? 'T+2' : 'T+1') : (#market == 'US' ? (#assetClass == 'EQUITY' ? 'T+2' : 'T+1') : (#market == 'GERMANY' ? 'T+2' : 'T+3'))"
      result-field: "settlementConvention"
    field-mappings:
      - source-field: "settlementConvention"
        target-field: "settlementConvention"

  # 2. Currency Conversion for Cross-Border Settlements
  - id: "currency-conversion"
    name: "currency-conversion"
    type: "calculation-enrichment"
    description: "Calculate currency conversion for cross-border settlements"
    condition: "#sourceCurrency != null && #targetCurrency != null && #sourceCurrency != #targetCurrency"
    calculation-config:
      expression: "#sourceCurrency + '/' + #targetCurrency + ' conversion required - Rate: ' + (#sourceCurrency == 'USD' && #targetCurrency == 'EUR' ? '0.85' : (#sourceCurrency == 'GBP' && #targetCurrency == 'USD' ? '1.25' : '1.00'))"
      result-field: "currencyConversion"
    field-mappings:
      - source-field: "currencyConversion"
        target-field: "currencyConversion"

  # 3. Risk Assessment for High-Value Transactions
  - id: "risk-assessment"
    name: "risk-assessment"
    type: "calculation-enrichment"
    description: "Assess risk level for high-value transactions"
    condition: "#totalValue != null || (#quantity != null && #price != null)"
    calculation-config:
      expression: "(#totalValue != null ? #totalValue : (#quantity * #price)) > 50000000 ? 'HIGH_RISK' : ((#totalValue != null ? #totalValue : (#quantity * #price)) > 10000000 ? 'MEDIUM_RISK' : 'LOW_RISK')"
      result-field: "riskAssessment"
    field-mappings:
      - source-field: "riskAssessment"
        target-field: "riskAssessment"

  # 4. Regulatory Compliance Check
  - id: "regulatory-compliance"
    name: "regulatory-compliance"
    type: "calculation-enrichment"
    description: "Check regulatory compliance requirements"
    condition: "#market != null && #assetClass != null"
    calculation-config:
      expression: "#market == 'US' ? 'SEC_COMPLIANCE_REQUIRED' : (#market == 'UK' ? 'FCA_COMPLIANCE_REQUIRED' : (#market == 'GERMANY' ? 'BAFIN_COMPLIANCE_REQUIRED' : 'STANDARD_COMPLIANCE'))"
      result-field: "regulatoryCompliance"
    field-mappings:
      - source-field: "regulatoryCompliance"
        target-field: "regulatoryCompliance"

  # 5. Settlement Status and Summary
  - id: "settlement-summary"
    name: "settlement-summary"
    type: "calculation-enrichment"
    description: "Generate comprehensive settlement summary"
    condition: "#tradeId != null && #assetClass != null"
    calculation-config:
      expression: "'Settlement processed for ' + #assetClass + ' trade ' + #tradeId + ' - Market: ' + (#market != null ? #market : 'UNKNOWN') + ' - Status: PROCESSED'"
      result-field: "settlementResult"
    field-mappings:
      - source-field: "settlementResult"
        target-field: "settlementResult"
