# Layered API Demo Configuration
# Real APEX YAML configuration for LayeredAPIDemo.java
# NO HARDCODED SIMULATION - Uses authentic APEX services

metadata:
  id: "layered-api-demo-configuration"
  name: "Layered API Demo Configuration"
  version: "2.0.0"
  description: "Real APEX layered API demonstration with Layer 1 simple validation, Layer 2 business rule management, and Layer 3 advanced features"
  type: "rule-config"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  tags: ["apex-demo", "evaluation", "layered-api"]

# APEX enrichment processing for layered API operations (4 enrichments total)
enrichments:
  - id: "layer1-enrichment"
    name: "layer1"
    type: "calculation-enrichment"
    description: "Processes Layer 1 simple validation and rule testing"
    condition: "#layer1Type != null"
    calculation-config:
      expression: "'Layer 1 processing: ' + #layer1Type + ' with ' + (#validationScope != null ? #validationScope : 'default-scope') + ' validation'"
      result-field: "layer1Result"
    field-mappings:
      - source-field: "layer1Result"
        target-field: "layer1Result"

  - id: "layer2-enrichment"
    name: "layer2"
    type: "calculation-enrichment"
    description: "Processes Layer 2 business rule management with YAML-driven configuration"
    condition: "#layer2Type != null"
    calculation-config:
      expression: "'Layer 2 processing: ' + #layer2Type + ' with ' + (#ruleScope != null ? #ruleScope : 'default-rules') + ' management'"
      result-field: "layer2Result"
    field-mappings:
      - source-field: "layer2Result"
        target-field: "layer2Result"

  - id: "layer3-enrichment"
    name: "layer3"
    type: "calculation-enrichment"
    description: "Processes Layer 3 advanced rule engine features with complex processing"
    condition: "#layer3Type != null"
    calculation-config:
      expression: "'Layer 3 processing: ' + #layer3Type + ' with ' + (#processingScope != null ? #processingScope : 'default-processing') + ' capabilities'"
      result-field: "layer3Result"
    field-mappings:
      - source-field: "layer3Result"
        target-field: "layer3Result"

  - id: "layered-summary-enrichment"
    name: "layered-summary"
    type: "calculation-enrichment"
    description: "Generates comprehensive layered API summary"
    condition: "true"
    calculation-config:
      expression: "'Layered API processing completed using real APEX services with approach: ' + (#approach != null ? #approach : 'unknown')"
      result-field: "layeredSummary"
    field-mappings:
      - source-field: "layeredSummary"
        target-field: "layeredSummary"

# Performance Configuration by Layer
performance-configuration:
  layer1:
    cache-enabled: true
    cache-ttl: 300
    max-processing-time: 100
    concurrent-processing: false
    
  layer2:
    cache-enabled: true
    cache-ttl: 600
    max-processing-time: 500
    concurrent-processing: true
    rule-optimization: true
    
  layer3:
    cache-enabled: true
    cache-ttl: 900
    max-processing-time: 2000
    concurrent-processing: true
    rule-optimization: true
    advanced-analytics: true

# API Layer Definitions
api-layers:
  - layer: "LAYER_1"
    name: "Simple Validation Layer"
    description: "Basic field validation and simple rule testing"
    features:
      - "field-validation"
      - "simple-rule-testing"
      - "basic-error-handling"
    performance-characteristics:
      - "low-latency"
      - "high-throughput"
      - "minimal-memory-usage"
    
  - layer: "LAYER_2"
    name: "Business Rule Management Layer"
    description: "Complex business rule management with named rules and templates"
    features:
      - "named-rule-definitions"
      - "business-rule-templates"
      - "rule-composition"
      - "conditional-execution"
    performance-characteristics:
      - "medium-latency"
      - "medium-throughput"
      - "moderate-memory-usage"
    
  - layer: "LAYER_3"
    name: "Advanced Features Layer"
    description: "Enterprise-grade features with complex processing and analytics"
    features:
      - "complex-rule-chains"
      - "advanced-analytics"
      - "performance-monitoring"
      - "enterprise-integration"
      - "audit-trails"
    performance-characteristics:
      - "higher-latency"
      - "lower-throughput"
      - "higher-memory-usage"
      - "advanced-caching"

# Rule Templates by Layer
rule-templates:
  layer1-templates:
    - name: "basic-field-validation"
      pattern: "#field != null && #field.length() > 0"
      description: "Basic non-null and non-empty validation"
    - name: "numeric-range-validation"
      pattern: "#field >= #min && #field <= #max"
      description: "Numeric range validation"
    - name: "email-format-validation"
      pattern: "#field != null && #field.contains('@')"
      description: "Basic email format validation"
      
  layer2-templates:
    - name: "business-approval-rule"
      pattern: "#amount <= #limit && (#type == 'PREMIUM' || #amount <= #threshold)"
      description: "Business approval rule template"
    - name: "customer-eligibility-rule"
      pattern: "#customerType == #requiredType && #amount > #minimumAmount"
      description: "Customer eligibility rule template"
    - name: "discount-qualification-rule"
      pattern: "#customerTier == 'PREMIUM' && #orderValue > #discountThreshold"
      description: "Discount qualification rule template"
      
  layer3-templates:
    - name: "enterprise-compliance-rule"
      pattern: "#amount > #threshold && #amlCheck == true && #sanctionsCheck == true && #riskRating == 'LOW'"
      description: "Enterprise compliance rule template"
    - name: "risk-assessment-rule"
      pattern: "#transactionAmount > #riskThreshold || #customerRisk == 'HIGH' || #countryRisk == 'HIGH'"
      description: "Risk assessment rule template"
    - name: "regulatory-reporting-rule"
      pattern: "#jurisdiction != 'DOMESTIC' && #amount > #reportingThreshold"
      description: "Regulatory reporting rule template"

# Processing Configuration
processing:
  fail-fast: false
  enable-logging: true
  max-processing-time: 30000
  layer-specific-processing: true
  performance-monitoring: true
  
# Output Configuration
output:
  format: "json"
  include-metadata: true
  include-processing-time: true
  include-layer-information: true
  include-performance-metrics: true
  include-rule-execution-details: true

# Error Handling Configuration
error-handling:
  layer1-errors: "fail-fast"
  layer2-errors: "collect-and-continue"
  layer3-errors: "collect-with-fallback"
  validation-errors: "collect"
  business-rule-errors: "collect-and-continue"
  advanced-feature-errors: "collect-with-fallback"

