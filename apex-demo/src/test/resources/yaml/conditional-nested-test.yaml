metadata:
  id: "conditional-nested-test"
  name: "Conditional Nested Logic Test"
  version: "1.0.0"
  description: "Test nested conditional expressions and complex branching logic"
  type: "rule-config"
  author: "apex-test-suite@example.com"
  created-date: "2025-09-14"
  tags: ["apex-test", "conditional", "nested", "branching", "complex-logic"]

# Nested conditional logic testing
enrichments:
  - id: "loan-eligibility-assessment"
    name: "loan-eligibility-assessment"
    type: "calculation-enrichment"
    description: "Assess loan eligibility using nested conditions"
    condition: "#accountType != null && #creditScore != null && #accountBalance != null"
    calculation-config:
      expression: "#accountType == 'BUSINESS' ? (#creditScore >= 750 ? (#accountBalance >= 100000 ? 'APPROVED' : 'CONDITIONAL') : 'DECLINED') : (#creditScore >= 700 ? (#accountBalance >= 50000 ? 'APPROVED' : 'CONDITIONAL') : 'DECLINED')"
      result-field: "loanEligibility"
    field-mappings:
      - source-field: "loanEligibility"
        target-field: "loanEligibility"

  - id: "interest-tier-calculation"
    name: "interest-tier-calculation"
    type: "calculation-enrichment"
    description: "Calculate interest tier using nested credit and balance conditions"
    condition: "#creditScore != null && #accountBalance != null && #yearsWithBank != null"
    calculation-config:
      expression: "#creditScore >= 750 ? (#accountBalance >= 200000 ? 'TIER_1' : (#yearsWithBank >= 3 ? 'TIER_2' : 'TIER_3')) : (#creditScore >= 700 ? (#accountBalance >= 100000 ? 'TIER_2' : 'TIER_3') : 'TIER_4')"
      result-field: "interestTier"
    field-mappings:
      - source-field: "interestTier"
        target-field: "interestTier"

  - id: "loan-limit-calculation"
    name: "loan-limit-calculation"
    type: "calculation-enrichment"
    description: "Calculate loan limit using nested account type and collateral conditions"
    condition: "#accountType != null && #hasCollateral != null && #accountBalance != null"
    calculation-config:
      expression: "#accountType == 'BUSINESS' ? (#hasCollateral ? (#accountBalance >= 200000 ? 500000 : 300000) : (#accountBalance >= 100000 ? 200000 : 100000)) : (#hasCollateral ? (#accountBalance >= 100000 ? 250000 : 150000) : (#accountBalance >= 50000 ? 100000 : 50000))"
      result-field: "loanLimit"
    field-mappings:
      - source-field: "loanLimit"
        target-field: "loanLimit"

  - id: "risk-category-assessment"
    name: "risk-category-assessment"
    type: "calculation-enrichment"
    description: "Assess risk category using nested business logic"
    condition: "#accountType != null && #yearsWithBank != null && #industryRisk != null && #creditScore != null"
    calculation-config:
      expression: "#accountType == 'BUSINESS' ? (#yearsWithBank >= 5 ? (#industryRisk == 'LOW' ? (#creditScore >= 750 ? 'LOW_RISK' : 'MEDIUM_RISK') : 'MEDIUM_RISK') : (#industryRisk == 'LOW' ? 'MEDIUM_RISK' : 'HIGH_RISK')) : (#yearsWithBank >= 3 ? (#creditScore >= 700 ? 'LOW_RISK' : 'MEDIUM_RISK') : 'MEDIUM_RISK')"
      result-field: "riskCategory"
    field-mappings:
      - source-field: "riskCategory"
        target-field: "riskCategory"
