metadata:
  name: "Rule-Chain Document Sequential Execution Test"
  version: "1.0.0"
  description: "Test rule-chain document with sequential dependency pattern"
  type: "rule-chain"
  id: "rule-chain-sequential-test"
  author: "apex-test-suite@example.com"
  created: "2025-09-14"
  last-modified: "2025-09-14"
  tags: ["test", "rule-chain", "sequential", "dependency"]

rule-chains:
  # Loan Approval Sequential Workflow
  - id: "loan-approval-workflow"
    name: "Loan Approval Sequential Workflow"
    description: "Sequential dependency chain for loan approval process"
    pattern: "sequential-dependency"
    enabled: true
    priority: 10
    category: "financial-services"
    
    configuration:
      stages:
        # Stage 1: Initial Screening
        - stage: 1
          name: "Initial Screening"
          description: "Basic eligibility screening"
          rule:
            condition: "#creditScore >= 600 && #income >= 30000 && #debtToIncome <= 0.5"
            message: "Initial screening passed - candidate meets basic requirements"
            severity: "INFO"
          output-variable: "initialScreeningPassed"
          failure-action: "terminate"

        # Stage 2: Document Verification
        - stage: 2
          name: "Document Verification"
          description: "Verify required documentation"
          depends-on: [1]
          rule:
            condition: "#initialScreeningPassed && #documentsComplete == true && #identityVerified == true"
            message: "Document verification completed successfully"
            severity: "INFO"
          output-variable: "documentsVerified"
          failure-action: "terminate"

        # Stage 3: Credit Assessment
        - stage: 3
          name: "Credit Assessment"
          description: "Detailed credit history analysis"
          depends-on: [2]
          rule:
            condition: "#documentsVerified && #creditHistoryLength >= 24 && #bankruptcyHistory == false"
            message: "Credit assessment completed - acceptable credit profile"
            severity: "INFO"
          output-variable: "creditAssessmentPassed"
          failure-action: "continue-with-conditions"

        # Stage 4: Final Approval
        - stage: 4
          name: "Final Approval"
          description: "Final loan approval decision"
          depends-on: [1, 2, 3]
          rule:
            condition: "#initialScreeningPassed && #documentsVerified && (#creditAssessmentPassed || #manualOverride == true)"
            message: "Loan approved - all criteria satisfied"
            severity: "INFO"
          output-variable: "loanApproved"
          success-action: "approve-loan"
          failure-action: "reject-loan"

  # Trade Settlement Sequential Chain
  - id: "trade-settlement-sequential"
    name: "Trade Settlement Sequential Chain"
    description: "Sequential processing for trade settlement"
    pattern: "sequential-dependency"
    enabled: true
    priority: 20
    category: "trade-processing"
    
    configuration:
      stages:
        # Stage 1: Trade Validation
        - stage: 1
          name: "Trade Validation"
          description: "Basic trade data validation"
          rule:
            condition: "#tradeId != null && #counterparty != null && #notionalAmount > 0 && #settlementDate != null"
            message: "Trade data validation passed"
            severity: "INFO"
          output-variable: "tradeValidated"
          failure-action: "terminate"

        # Stage 2: Risk Assessment
        - stage: 2
          name: "Risk Assessment"
          description: "Assess trade risk level"
          depends-on: [1]
          rule:
            condition: "#tradeValidated && (#notionalAmount <= 1000000 || #counterpartyRating >= 'A-')"
            message: "Risk assessment completed - acceptable risk level"
            severity: "INFO"
          output-variable: "riskAssessmentPassed"
          failure-action: "escalate"

        # Stage 3: Settlement Processing
        - stage: 3
          name: "Settlement Processing"
          description: "Process trade settlement"
          depends-on: [1, 2]
          rule:
            condition: "#tradeValidated && #riskAssessmentPassed && #settlementInstructions != null"
            message: "Settlement processing initiated"
            severity: "INFO"
          output-variable: "settlementProcessed"
          success-action: "complete-settlement"
