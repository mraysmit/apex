# ============================================================================
# APEX YAML Configuration File
# ============================================================================
# Used by: ORPHANED - No Java test currently uses this file
# Purpose: Complete customer onboarding workflow demonstration using APEX rule chains
#          with sequential dependencies, validation gates, and multi-stage business
#          process automation for customer management scenarios
# Status: Available for integration with customer onboarding workflow tests
# ============================================================================

metadata:
  id: "customer-onboarding-workflow"
  name: "Customer Onboarding Workflow"
  version: "1.0.0"
  description: "Complete customer onboarding workflow using rule chains with sequential dependencies"
  type: "rule-chain"
  author: "apex-business-tests"
  business-domain: "Customer Management"
  tags: ["customer-onboarding", "workflow", "rule-chain", "business-process"]

# Real rule chain workflow for customer onboarding process
rule-chains:
  - id: "customer-onboarding-process"
    name: "Customer Onboarding Process"
    description: "Sequential workflow for new customer onboarding with validation gates"
    pattern: "sequential-dependency"
    enabled: true
    priority: 10
    category: "customer-management"
    
    configuration:
      stages:
        # Stage 1: Initial Data Validation
        - stage: 1
          name: "Initial Data Validation"
          description: "Validate basic customer information and required fields"
          rule:
            condition: "#customerName != null && #email != null && #phone != null && #dateOfBirth != null"
            message: "Initial data validation passed - all required fields present"
            severity: "INFO"
          output-variable: "initialValidationPassed"
          failure-action: "terminate"

        # Stage 2: Identity Verification
        - stage: 2
          name: "Identity Verification"
          description: "Verify customer identity using external identity service"
          depends-on: [1]
          rule:
            condition: "#initialValidationPassed == true && #identityDocument != null && #identityDocument.length() >= 8"
            message: "Identity verification completed successfully"
            severity: "INFO"
          output-variable: "identityVerified"
          failure-action: "escalate"

        # Stage 3: Credit Score Check
        - stage: 3
          name: "Credit Score Assessment"
          description: "Assess customer creditworthiness and risk profile"
          depends-on: [2]
          rule:
            condition: "#identityVerified == true && #annualIncome != null && #annualIncome >= 25000"
            message: "Credit assessment completed - customer meets minimum income requirements"
            severity: "INFO"
          output-variable: "creditAssessmentPassed"
          failure-action: "manual-review"

        # Stage 4: Risk Categorization
        - stage: 4
          name: "Risk Categorization"
          description: "Categorize customer risk level based on assessment results"
          depends-on: [3]
          rule:
            condition: "#creditAssessmentPassed == true && #annualIncome >= 50000"
            message: "Customer categorized as low risk - standard onboarding approved"
            severity: "INFO"
          output-variable: "riskCategorized"
          failure-action: "enhanced-due-diligence"

        # Stage 5: Account Setup
        - stage: 5
          name: "Account Setup"
          description: "Create customer accounts and initialize services"
          depends-on: [4]
          rule:
            condition: "#riskCategorized == true && #accountType != null"
            message: "Account setup initiated for approved customer"
            severity: "INFO"
          output-variable: "accountSetupInitiated"
          failure-action: "retry"

        # Stage 6: Welcome Package
        - stage: 6
          name: "Welcome Package Generation"
          description: "Generate welcome materials and account information"
          depends-on: [5]
          rule:
            condition: "#accountSetupInitiated == true"
            message: "Welcome package generated and ready for delivery"
            severity: "INFO"
          output-variable: "welcomePackageReady"
          failure-action: "continue"

    # Workflow execution configuration
    execution:
      mode: "sequential"
      timeout: 300000
      retry-policy:
        max-retries: 3
        retry-delay: 5000
        exponential-backoff: true
      
    # Error handling configuration
    error-handling:
      on-stage-failure: "escalate"
      escalation-queue: "customer-onboarding-exceptions"
      notification-enabled: true
      
    # Monitoring and audit configuration
    monitoring:
      enabled: true
      log-level: "INFO"
      audit-trail: true
      performance-tracking: true
      
  # Additional rule chain for high-risk customer processing
  - id: "high-risk-customer-process"
    name: "High-Risk Customer Enhanced Due Diligence"
    description: "Enhanced due diligence process for high-risk customers"
    pattern: "conditional-branching"
    enabled: true
    priority: 20
    category: "risk-management"
    
    configuration:
      stages:
        # Enhanced verification stage
        - stage: 1
          name: "Enhanced Identity Verification"
          description: "Additional identity verification for high-risk customers"
          rule:
            condition: "#riskCategory == 'HIGH' && #additionalDocuments != null"
            message: "Enhanced identity verification required for high-risk customer"
            severity: "WARN"
          output-variable: "enhancedVerificationRequired"
          failure-action: "manual-review"

        # Compliance screening
        - stage: 2
          name: "Compliance Screening"
          description: "Screen customer against sanctions and PEP lists"
          depends-on: [1]
          rule:
            condition: "#enhancedVerificationRequired == true && #complianceScreening == 'CLEAR'"
            message: "Compliance screening completed - no adverse findings"
            severity: "INFO"
          output-variable: "complianceScreeningPassed"
          failure-action: "reject"

        # Senior management approval
        - stage: 3
          name: "Senior Management Approval"
          description: "Require senior management approval for high-risk customers"
          depends-on: [2]
          rule:
            condition: "#complianceScreeningPassed == true"
            message: "High-risk customer requires senior management approval"
            severity: "WARN"
          output-variable: "seniorApprovalRequired"
          failure-action: "escalate"

    execution:
      mode: "sequential"
      timeout: 600000
      manual-intervention-allowed: true
      
    error-handling:
      on-stage-failure: "escalate"
      escalation-queue: "high-risk-customer-review"
      senior-management-notification: true
