metadata:
  id: "dataset-database-test"
  name: "Dataset Document Database Data Test"
  version: "1.0.0"
  description: "Test dataset document type with database data source configuration"
  type: "dataset"
  source: "Reference Data Database"
  created-by: "APEX Test Suite"
  created-date: "2025-01-14"
  business-domain: "Testing"

data:
  # Database configuration record
  - recordType: "database-config"
    type: "database"
    name: "reference-data-db"
    description: "Database connection for reference data"
    driver: "org.h2.Driver"
    url: "jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE"
    username: "sa"
    password: ""
    poolSize: 10
    connectionTimeout: 30000
    idleTimeout: 600000
    maxLifetime: 1800000

  # Query configuration records
  - recordType: "query-config"
    queryName: "counterparties"
    sql: "SELECT lei, name, jurisdiction, entity_type as entityType, credit_rating as creditRating FROM counterparties WHERE active = true ORDER BY name"
    keyField: "lei"
    cachingEnabled: true
    cacheTtl: 1800

  - recordType: "query-config"
    queryName: "currencies"
    sql: "SELECT code, name, symbol, country, region, is_base_currency as isBaseCurrency FROM currencies WHERE active = true ORDER BY code"
    keyField: "code"
    cachingEnabled: true
    cacheTtl: 3600

  - recordType: "query-config"
    queryName: "instruments"
    sql: "SELECT id, type, maturity, issuer, currency, coupon_rate as couponRate FROM instruments WHERE active = true ORDER BY id"
    keyField: "id"
    cachingEnabled: true
    cacheTtl: 900

  # Initialization configuration records
  - recordType: "initialization-config"
    createTables: true
    loadSampleData: true

  - recordType: "table-creation-script"
    tableName: "counterparties"
    sql: "CREATE TABLE IF NOT EXISTS counterparties (lei VARCHAR(20) PRIMARY KEY, name VARCHAR(255) NOT NULL, jurisdiction VARCHAR(2) NOT NULL, entity_type VARCHAR(50), credit_rating VARCHAR(10), active BOOLEAN DEFAULT true)"

  - recordType: "table-creation-script"
    tableName: "currencies"
    sql: "CREATE TABLE IF NOT EXISTS currencies (code VARCHAR(3) PRIMARY KEY, name VARCHAR(100) NOT NULL, symbol VARCHAR(10), country VARCHAR(100), region VARCHAR(50), is_base_currency BOOLEAN DEFAULT false, active BOOLEAN DEFAULT true)"

  - recordType: "table-creation-script"
    tableName: "instruments"
    sql: "CREATE TABLE IF NOT EXISTS instruments (id VARCHAR(20) PRIMARY KEY, type VARCHAR(50) NOT NULL, maturity VARCHAR(10), issuer VARCHAR(100), currency VARCHAR(3), coupon_rate DECIMAL(5,3), active BOOLEAN DEFAULT true)"
