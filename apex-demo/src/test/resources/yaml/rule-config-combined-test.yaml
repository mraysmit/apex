metadata:
  id: "rule-config-combined-test"
  name: "Rule-Config Combined Test"
  version: "1.0.0"
  description: "Test rule-config document type with both rules and enrichments sections"
  type: "rule-config"
  author: "apex-test-suite@example.com"
  created-by: "APEX Test Suite"
  created-date: "2025-01-14"
  business-domain: "Testing"

rules:
  - id: "trade-validation"
    name: "Trade Data Validation"
    description: "Validate core trade data fields"
    condition: "#tradeId != null && #counterpartyName != null && #instrumentId != null && #quantity > 0 && #price > 0"
    message: "All trade fields must be valid: tradeId, counterpartyName, instrumentId present; quantity and price positive"
    severity: "ERROR"
    
  - id: "notional-threshold-check"
    name: "Notional Amount Threshold Check"
    description: "Check if trade exceeds reporting threshold"
    condition: "#notionalAmount == null || #notionalAmount <= 10000000"
    message: "Large trades (>10M) require additional approval"
    severity: "WARNING"

enrichments:
  - id: "counterparty-enrichment"
    name: "Counterparty Data Enrichment"
    type: "lookup-enrichment"
    description: "Enrich counterparty information"
    condition: "#counterpartyName != null"
    lookup-config:
      lookup-key: "#counterpartyName"
      lookup-dataset:
        type: "inline"
        key-field: "name"
        data:
          - name: "Deutsche Bank"
            lei: "7LTWFZYICNSX8D621K86"
            jurisdiction: "DE"
            entityType: "BANK"
            creditRating: "A+"
          - name: "JPMorgan Chase"
            lei: "8EE8DF3643E15DBFDA05"
            jurisdiction: "US"
            entityType: "BANK"
            creditRating: "AA-"
    field-mappings:
      - source-field: "lei"
        target-field: "counterpartyLei"
      - source-field: "creditRating"
        target-field: "counterpartyCreditRating"

  - id: "trade-metrics-calculation"
    name: "Trade Metrics Calculation"
    type: "calculation-enrichment"
    description: "Calculate derived trade metrics"
    condition: "#quantity != null && #price != null"
    calculation-config:
      expression: "#quantity * #price"
      result-field: "calculatedNotional"
    field-mappings:
      - source-field: "calculatedNotional"
        target-field: "calculatedNotional"
