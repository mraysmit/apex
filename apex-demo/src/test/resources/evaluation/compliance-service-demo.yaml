# APEX Compliance Service Demo Configuration
# Real APEX YAML configuration for compliance processing
# Replaces all hardcoded compliance logic from ComplianceServiceDemo (@version 1.0)

metadata:
  id: "compliance-service-demo"
  name: "Compliance Service Demo"
  version: "2.0.0"
  description: "APEX-compliant compliance service processing with real enrichment services"
  type: "rule-config"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  business-domain: "Financial Compliance"
  tags: ["compliance", "demo", "enrichment", "financial-services"]

# APEX enrichment processing for compliance checking
enrichments:
  - id: "regulatory-compliance-check"
    name: "regulatory-compliance-check"
    type: "lookup-enrichment"
    description: "Determine applicable regulations for trade type"
    condition: "#tradeType != null"
    lookup-config:
      lookup-key: "#tradeType"
      lookup-dataset:
        type: "inline"
        key-field: "tradeType"
        data:
          - tradeType: "EQUITY"
            regulations: "MiFID II,EMIR"
            reportingRequired: true
          - tradeType: "BOND"
            regulations: "MiFID II,Basel III"
            reportingRequired: true
          - tradeType: "DERIVATIVE"
            regulations: "EMIR,Dodd-Frank,SFTR"
            reportingRequired: true
          - tradeType: "OTC_DERIVATIVE"
            regulations: "EMIR,Dodd-Frank,SFTR"
            reportingRequired: true
          - tradeType: "SWAP"
            regulations: "Dodd-Frank,EMIR,SFTR"
            reportingRequired: true
          - tradeType: "CROSS_CURRENCY_SWAP"
            regulations: "Dodd-Frank,EMIR,MiFID II,SFTR"
            reportingRequired: true
          - tradeType: "FX"
            regulations: "EMIR,Basel III"
            reportingRequired: false
    field-mappings:
      - source-field: "regulations"
        target-field: "applicableRegulations"
      - source-field: "reportingRequired"
        target-field: "reportingRequired"

  - id: "mifid-reporting-check"
    name: "mifid-reporting-check"
    type: "calculation-enrichment"
    description: "Check MiFID II reporting requirement"
    condition: "#applicableRegulations != null"
    calculation-config:
      expression: "#applicableRegulations.contains('MiFID II') ? 'REQUIRED' : 'NOT_REQUIRED'"
      result-field: "mifidReporting"
    field-mappings:
      - source-field: "mifidReporting"
        target-field: "mifidReporting"

  - id: "emir-reporting-check"
    name: "emir-reporting-check"
    type: "calculation-enrichment"
    description: "Check EMIR reporting requirement"
    condition: "#applicableRegulations != null"
    calculation-config:
      expression: "#applicableRegulations.contains('EMIR') ? 'REQUIRED' : 'NOT_REQUIRED'"
      result-field: "emirReporting"
    field-mappings:
      - source-field: "emirReporting"
        target-field: "emirReporting"

  - id: "dodd-frank-reporting-check"
    name: "dodd-frank-reporting-check"
    type: "calculation-enrichment"
    description: "Check Dodd-Frank reporting requirement"
    condition: "#applicableRegulations != null"
    calculation-config:
      expression: "#applicableRegulations.contains('Dodd-Frank') ? 'REQUIRED' : 'NOT_REQUIRED'"
      result-field: "doddFrankReporting"
    field-mappings:
      - source-field: "doddFrankReporting"
        target-field: "doddFrankReporting"

  - id: "compliance-issues-check"
    name: "compliance-issues-check"
    type: "calculation-enrichment"
    description: "Check for compliance issues"
    condition: "true"
    calculation-config:
      expression: "#tradeId == null || #tradeType == null || #category == null ? true : false"
      result-field: "hasComplianceIssues"
    field-mappings:
      - source-field: "hasComplianceIssues"
        target-field: "hasComplianceIssues"

  - id: "compliance-summary"
    name: "compliance-summary"
    type: "calculation-enrichment"
    description: "Generate compliance processing summary"
    condition: "true"
    calculation-config:
      expression: "'Compliance processing completed for trade: ' + (#tradeId != null ? #tradeId : 'UNKNOWN') + ', Type: ' + (#tradeType != null ? #tradeType : 'UNKNOWN')"
      result-field: "complianceSummary"
    field-mappings:
      - source-field: "complianceSummary"
        target-field: "complianceSummary"

