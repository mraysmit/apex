# Shared DataSource Demo Configuration
# This demonstrates proper H2 database integration with APEX

metadata:
  name: "Shared DataSource Demo"
  version: "1.0.0"
  description: "Simple demo showing proper H2 database integration with APEX"
  type: "external-data-config"
  author: "apex.demo@company.com"
  created: "2025-09-03"
  tags: ["demo", "h2", "shared-datasource", "simple"]

# Data source configuration using shared approach
data-sources:
  - name: "shared-customer-db"
    type: "database"
    source-type: "h2"
    enabled: true
    description: "Shared H2 database for customer data"
    tags:
      - "demo"
      - "shared"
      - "customers"
    
    connection:
      # H2 file-based database for true sharing between demo and APEX
      database: "./target/h2-demo/apex_demo_shared"
      username: "sa"
      password: ""
    
    # Simple query for customer lookup
    queries:
      customerLookup: "SELECT customer_name, customer_type, tier, region, status FROM customers WHERE customer_id = :customerId"
    
    # Parameter definitions
    parameterNames:
      - "customerId"
    
    # Health check
    healthCheck:
      enabled: true
      query: "SELECT 1"
      intervalSeconds: 30
      timeoutSeconds: 5

# Simple enrichment rule
enrichments:
  - id: "customer-lookup"
    type: "lookup-enrichment"
    enabled: true
    description: "Look up customer details by ID"
    priority: 1
    
    # Condition for when to apply this enrichment
    condition: "#customerId != null"
    
    # Lookup configuration
    lookup:
      type: "database"
      dataset-id: "dataset-customer-lookup-database"
      data-source: "shared-customer-db"
      query: "customerLookup"
      
      # Parameters for the lookup
      parameters:
        customerId: "#customerId"
      
      # Cache configuration
      cache:
        enabled: true
        ttlSeconds: 300
        maxSize: 100
    
    # Field mappings from lookup result to enriched object
    field-mappings:
      - source-field: "customer_name"
        target-field: "customerName"
        required: true
      - source-field: "customer_type"
        target-field: "customerType"
        required: true
      - source-field: "tier"
        target-field: "customerTier"
        required: true
      - source-field: "region"
        target-field: "customerRegion"
        required: true
      - source-field: "status"
        target-field: "customerStatus"
        required: true
