# H2 Custom Parameters Enrichment Demo
# Demonstrates H2 database custom parameters functionality with business logic enrichments
# Use Case: Test H2 custom parameter processing with calculated business results

metadata:
  id: "h2-custom-parameters-enrichment-demo"
  name: "H2 Custom Parameters Enrichment Demo"
  version: "1.0.0"
  description: "Demonstrates H2 database custom parameters functionality with business logic enrichments"
  type: "enrichment"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  tags: ["apex-demo", "h2", "custom-parameters", "calculation"]

# Database configuration for customer data (using same database as customer-profile-enrichment)
data-sources:
  - name: "customer-database"
    type: "database"
    sourceType: "h2"
    connection:
      # H2 file-based database for true sharing between demo and APEX
      database: "./target/h2-demo/apex_demo_shared"
      username: "sa"
      password: ""

# Business logic enrichments for H2 custom parameters functionality
enrichments:
  # 1. Customer Profile Lookup (foundation data)
  - id: "customer-profile-lookup"
    type: "lookup-enrichment"
    description: "Lookup customer profile data from H2 database"
    condition: "#customerId != null && #customerId != ''"
    lookup-config:
      lookup-key: "#customerId"
      lookup-dataset:
        type: "database"
        data-source-ref: "customer-database"
        query: "SELECT customer_name, customer_type, tier, region, status, created_date FROM customers WHERE customer_id = :customerId"
        parameters:
          - field: "customerId"
            type: "string"
    field-mappings:
      - source-field: "CUSTOMER_NAME"
        target-field: "customerName"
      - source-field: "CUSTOMER_TYPE"
        target-field: "customerType"
      - source-field: "TIER"
        target-field: "customerTier"
      - source-field: "REGION"
        target-field: "customerRegion"
      - source-field: "STATUS"
        target-field: "customerStatus"
      - source-field: "CREATED_DATE"
        target-field: "customerCreatedDate"

  # 2. Custom Database Initialization Result
  - id: "custom-database-initialization-enrichment"
    type: "calculation-enrichment"
    description: "Generate custom database initialization result based on initialization type"
    condition: "#initializationType != null"
    calculation-config:
      expression: "'Custom database initialization processing: ' + #initializationType + ' with ' + (#initializationScope != null ? #initializationScope : 'default-scope') + ' - Status: COMPLETED - Method: H2_CUSTOM_PARAMETERS'"
      result-field: "customDatabaseInitializationResult"
    field-mappings:
      - source-field: "customDatabaseInitializationResult"
        target-field: "customDatabaseInitializationResult"

  # 3. Parameter Merging Result
  - id: "parameter-merging-enrichment"
    type: "calculation-enrichment"
    description: "Generate parameter merging result based on merging type"
    condition: "#mergingType != null"
    calculation-config:
      expression: "'Parameter merging processing: ' + #mergingType + ' with ' + (#mergingScope != null ? #mergingScope : 'default-scope') + ' - Status: MERGED - Approach: APEX_DEFAULTS_INTEGRATION'"
      result-field: "parameterMergingResult"
    field-mappings:
      - source-field: "parameterMergingResult"
        target-field: "parameterMergingResult"

  # 4. Compatibility Mode Testing Result
  - id: "compatibility-mode-testing-enrichment"
    type: "calculation-enrichment"
    description: "Generate compatibility mode testing result based on compatibility type"
    condition: "#compatibilityType != null"
    calculation-config:
      expression: "'Compatibility mode testing processing: ' + #compatibilityType + ' with ' + (#compatibilityScope != null ? #compatibilityScope : 'default-scope') + ' - Status: VALIDATED - Mode: H2_POSTGRESQL_COMPATIBILITY'"
      result-field: "compatibilityModeTestingResult"
    field-mappings:
      - source-field: "compatibilityModeTestingResult"
        target-field: "compatibilityModeTestingResult"

  # 5. H2 Custom Parameters Summary
  - id: "h2-custom-parameters-summary-enrichment"
    type: "calculation-enrichment"
    description: "Generate comprehensive H2 custom parameters summary"
    condition: "#approach != null"
    calculation-config:
      expression: "'H2 Custom Parameters Summary: Processing completed using ' + #approach + ' - Database: H2_POSTGRESQL_MODE - Custom Parameters: ENABLED - Connection Pool: OPTIMIZED - Performance: ENHANCED'"
      result-field: "h2CustomParametersSummary"
    field-mappings:
      - source-field: "h2CustomParametersSummary"
        target-field: "h2CustomParametersSummary"
