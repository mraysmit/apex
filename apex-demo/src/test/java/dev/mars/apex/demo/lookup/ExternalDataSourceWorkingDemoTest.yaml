# External Data Source Working Demo Enrichment
# Demonstrates external data source working functionality with business logic enrichments
# Use Case: External data source working demonstration using APEX enrichment services

metadata:
  id: "external-data-source-working-enrichment-demo"
  name: "External Data Source Working Enrichment Demo"
  version: "1.0.0"
  description: "External data source working demonstration with business logic enrichments"
  type: "enrichment"
  author: "apex.demo.team@company.com"
  created-date: "2024-12-24"
  tags: ["apex-demo", "external-data-source", "working", "calculation"]

# Database configuration for customer data (using same database as other demos)
data-sources:
  - name: "customer-database"
    type: "database"
    sourceType: "h2"
    connection:
      # H2 file-based database for true sharing between demo and APEX
      database: "./target/h2-demo/apex_demo_shared"
      username: "sa"
      password: ""

# Business logic enrichments for external data source working scenarios
enrichments:
  # 1. Customer Profile Lookup (foundation data)
  - id: "customer-profile-lookup"
    type: "lookup-enrichment"
    description: "Lookup customer profile data from H2 database"
    condition: "#customerId != null && #customerId != ''"
    lookup-config:
      lookup-key: "#customerId"
      lookup-dataset:
        type: "database"
        data-source-ref: "customer-database"
        query: "SELECT customer_name, customer_type, tier, region, status, created_date FROM customers WHERE customer_id = :customerId"
        parameters:
          - field: "customerId"
            type: "string"
    field-mappings:
      - source-field: "CUSTOMER_NAME"
        target-field: "customerName"
      - source-field: "CUSTOMER_TYPE"
        target-field: "customerType"
      - source-field: "TIER"
        target-field: "customerTier"
      - source-field: "REGION"
        target-field: "customerRegion"
      - source-field: "STATUS"
        target-field: "customerStatus"
      - source-field: "CREATED_DATE"
        target-field: "customerCreatedDate"

  # 2. Database Initialization Result
  - id: "database-initialization-enrichment"
    type: "calculation-enrichment"
    description: "Generate database initialization result based on initialization type"
    condition: "#initializationType != null"
    calculation-config:
      expression: "'Database initialization processing: ' + #initializationType + ' with ' + (#initializationScope != null ? #initializationScope : 'default-scope') + ' - Status: COMPLETED - Method: EXTERNAL_DATA_SOURCE_WORKING'"
      result-field: "databaseInitializationResult"
    field-mappings:
      - source-field: "databaseInitializationResult"
        target-field: "databaseInitializationResult"

  # 3. Data Verification Result
  - id: "data-verification-enrichment"
    type: "calculation-enrichment"
    description: "Generate data verification result based on verification type"
    condition: "#verificationType != null"
    calculation-config:
      expression: "'Data verification processing: ' + #verificationType + ' with ' + (#verificationScope != null ? #verificationScope : 'default-scope') + ' - Status: VERIFIED - Approach: EXTERNAL_DATA_VALIDATION'"
      result-field: "dataVerificationResult"
    field-mappings:
      - source-field: "dataVerificationResult"
        target-field: "dataVerificationResult"

  # 4. External Reference Enrichment Result
  - id: "external-reference-enrichment"
    type: "calculation-enrichment"
    description: "Generate external reference enrichment result based on enrichment type"
    condition: "#enrichmentType != null"
    calculation-config:
      expression: "'External reference enrichment processing: ' + #enrichmentType + ' with ' + (#enrichmentScope != null ? #enrichmentScope : 'default-scope') + ' - Status: ENRICHED - Type: EXTERNAL_REFERENCE_PROCESSING'"
      result-field: "externalReferenceEnrichmentResult"
    field-mappings:
      - source-field: "externalReferenceEnrichmentResult"
        target-field: "externalReferenceEnrichmentResult"

  # 5. External Data Source Working Summary
  - id: "external-data-source-working-summary-enrichment"
    type: "calculation-enrichment"
    description: "Generate comprehensive external data source working summary"
    condition: "#approach != null"
    calculation-config:
      expression: "'External Data Source Working Summary: Processing completed using ' + #approach + ' - Database: H2_EXTERNAL_MODE - Data Sources: CONNECTED - Verification: PASSED - Enrichment: SUCCESSFUL'"
      result-field: "externalDataSourceWorkingSummary"
    field-mappings:
      - source-field: "externalDataSourceWorkingSummary"
        target-field: "externalDataSourceWorkingSummary"
