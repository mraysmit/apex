# H2 Custom Parameters Demo Configuration
# ========================================
# This demo showcases the enhanced H2 parameter support in APEX
# You can now specify custom H2 parameters directly in the database field

# ============================================================================
# APEX YAML Configuration File
# ============================================================================
# Used by: ORPHANED - No Java test currently uses this file
# Purpose: H2 database custom parameters demonstration using APEX lookup
#          enrichments with custom database parameters, parameterized queries,
#          and advanced H2 database integration capabilities
# Status: Available for integration with H2 custom parameters tests
# ============================================================================

metadata:
  id: "h2-custom-parameters-demo"
  name: "H2 Custom Parameters Demo"
  version: "1.0.0"
  description: "Demonstrates H2 database with custom parameters support"
  type: "external-data-config"
  author: "apex.demo.team@company.com"

# External data source configuration with custom H2 parameters
dataSources:
  - name: "h2-custom-database"
    type: "database"
    source-type: "h2"
    enabled: true
    description: "H2 database with custom parameters for enhanced functionality"

    connection:
      # Enhanced H2 configuration with custom parameters
      # Format: "path/to/database;PARAM1=value1;PARAM2=value2"
      # Custom parameters override defaults, additional parameters are preserved
      database: "./target/h2-demo/custom_params;MODE=MySQL;TRACE_LEVEL_FILE=2;CACHE_SIZE=32768"
      username: "sa"
      password: ""

    # Named queries for the demo
    queries:
      customerLookup: "SELECT customer_id, customer_name, customer_type, tier, region, status FROM customers WHERE customer_id = :customerId"
      customersByType: "SELECT customer_id, customer_name, tier FROM customers WHERE customer_type = :customerType"
      allCustomers: "SELECT customer_id, customer_name, customer_type, tier, region, status FROM customers ORDER BY customer_name"

    parameterNames:
      - "customerId"
      - "customerType"

    healthCheck:
      enabled: true
      query: "SELECT COUNT(*) as customer_count FROM customers"
      timeout: 5000

# Enrichment configurations
enrichments:
  - name: "customer-profile-enrichment-custom"
    description: "Enrich with customer profile data using custom H2 parameters"
    
    lookup-dataset:
      type: "database"
      data-source-ref: "h2-custom-database"
      query-ref: "customerLookup"
      
      parameters:
        - name: "customerId"
          source-field: "customerId"
          required: true

    # Field mappings (H2 returns uppercase column names)
    field-mappings:
      - source-field: "CUSTOMER_ID"
        target-field: "customerId"
      - source-field: "CUSTOMER_NAME"
        target-field: "customerName"
      - source-field: "CUSTOMER_TYPE"
        target-field: "customerType"
      - source-field: "TIER"
        target-field: "customerTier"
      - source-field: "REGION"
        target-field: "customerRegion"
      - source-field: "STATUS"
        target-field: "customerStatus"

  - name: "customer-type-enrichment"
    description: "Enrich with customers by type using custom H2 parameters"
    
    lookup-dataset:
      type: "database"
      data-source-ref: "h2-custom-database"
      query-ref: "customersByType"
      
      parameters:
        - name: "customerType"
          source-field: "customerType"
          required: true

    field-mappings:
      - source-field: "CUSTOMER_ID"
        target-field: "relatedCustomerId"
      - source-field: "CUSTOMER_NAME"
        target-field: "relatedCustomerName"
      - source-field: "TIER"
        target-field: "relatedCustomerTier"

# Example usage scenarios
examples:
  basic-lookup:
    description: "Basic customer lookup with custom H2 parameters"
    input:
      customerId: "CUST000001"
    expected-output:
      customerId: "CUST000001"
      customerName: "Acme Corporation"
      customerType: "CORPORATE"
      customerTier: "PLATINUM"
      customerRegion: "NA"
      customerStatus: "ACTIVE"

  type-based-lookup:
    description: "Lookup customers by type with enhanced H2 configuration"
    input:
      customerType: "CORPORATE"
    expected-output:
      relatedCustomerId: "CUST000001"
      relatedCustomerName: "Acme Corporation"
      relatedCustomerTier: "PLATINUM"

# Configuration notes
notes:
  h2-parameters:
    - "MODE=MySQL: Sets H2 to MySQL compatibility mode instead of default PostgreSQL"
    - "TRACE_LEVEL_FILE=2: Enables detailed SQL logging to trace files"
    - "CACHE_SIZE=32768: Sets database cache size to 32MB for better performance"
    - "DB_CLOSE_DELAY=-1: Automatically added - keeps database open between connections"
    
  parameter-precedence:
    - "Custom parameters override APEX defaults"
    - "APEX automatically adds DB_CLOSE_DELAY=-1 if not specified"
    - "Default MODE=PostgreSQL is overridden by custom MODE=MySQL"
    
  supported-formats:
    - "File-based: './path/to/db;PARAM=value'"
    - "In-memory: 'mem:dbname;PARAM=value'"
    - "No parameters: './path/to/db' (uses APEX defaults)"
