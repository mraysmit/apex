# ============================================================================
# APEX YAML Configuration File
# ============================================================================
# Used by: ConditionalMappingEnrichmentPhase3Test.java
# Purpose: Test Phase 3 conditional-mapping-enrichment functionality
# Status: Phase 3 functionality - Fully implemented and tested
# ============================================================================

metadata:
  id: "conditional-mapping-enrichment-phase-3-test"
  name: "Conditional Mapping Enrichment Phase 3 Test"
  version: "3.0.0"
  description: "Test configuration for new conditional-mapping-enrichment type"
  type: "scenario"
  author: "APEX Enhancement Team"
  created: "2025-09-17"

enrichments:
  # NEW ENRICHMENT TYPE: conditional-mapping-enrichment
  - id: "priority-based-ndf-mapping"
    type: "conditional-mapping-enrichment"
    name: "Priority-Based NDF Field Mapping"
    description: "Priority-based conditional field mapping with first-match-wins"
    enabled: true
    
    # Target field to be conditionally mapped
    target-field: "IS_NDF"
    
    # Priority-based mapping rules (processed in priority order)
    mapping-rules:
      # Rule 1: Highest priority - SWIFT system with specific values
      - id: "swift-high-priority"
        name: "SWIFT High Priority Mapping"
        priority: 1
        conditions:
          operator: "AND"
          rules:
            - condition: "#SYSTEM_CODE == 'SWIFT'"
            - condition: "#IS_NDF == 'Y'"
        mapping:
          type: "direct"                           # Direct mapping: executes SpEL transformation directly
          transformation: "'HIGH_PRIORITY_NDF'"   # SpEL: Returns literal string "HIGH_PRIORITY_NDF"
          
      # Rule 2: Medium priority - SWIFT system general
      - id: "swift-general"
        name: "SWIFT General Mapping"
        priority: 2
        conditions:
          operator: "AND"
          rules:
            - condition: "#SYSTEM_CODE == 'SWIFT'"
            - condition: "#IS_NDF != null"
        mapping:
          type: "direct"                           # Direct mapping: executes SpEL transformation directly
          source-field: "IS_NDF"                  # Source field reference (optional when using transformation)
          transformation: "#IS_NDF + '_SWIFT'"    # SpEL: Concatenates IS_NDF field value with "_SWIFT" suffix
          
      # Rule 3: Lower priority - Other systems
      - id: "other-systems"
        name: "Other Systems Mapping"
        priority: 3
        conditions:
          operator: "AND"
          rules:
            - condition: "#SYSTEM_CODE != 'SWIFT'"
            - condition: "#IS_NDF != null"
        mapping:
          type: "direct"                           # Direct mapping: executes SpEL transformation directly
          transformation: "'OTHER_SYSTEM_VALUE'"  # SpEL: Returns literal string "OTHER_SYSTEM_VALUE"
          
      # Rule 4: Default rule (lowest priority, no conditions)
      - id: "default-mapping"
        name: "Default Mapping"
        priority: 999
        # No conditions = always matches if no other rules match
        mapping:
          type: "direct"                           # Direct mapping: executes SpEL transformation directly
          transformation: "'DEFAULT_NDF'"         # SpEL: Returns literal string "DEFAULT_NDF" (fallback value)
          
    # Execution settings
    execution-settings:
      stop-on-first-match: true  # Stop after first matching rule
      log-matched-rule: true     # Log which rule was applied
      validate-result: false     # Skip result validation for simplicity
